{% extends 'base.html' %}
{% load i18n %}
{% load staticfiles %}
{% load common_tags %}

{% block content %}
<div class="card">
  <form action="" method='post'>
    <div class="card-content">
      <span class="card-title">{% if edit %}{% trans 'Edit Event' %}{% else %}{% trans 'Create Event' %}{% endif %}</span>
      {% if form.non_field_errors %}
      <div class="alert alert-danger">
        <ul>
          {% for error in form.non_field_errors %}
          <li>
            {{ error }}
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
      {% csrf_token %}
      <div class="input-field">
        {{ form.title }}
        <label for="{{ form.title.id_for_label }}">
          {{ form.title.label }}
        </label>
        {% for error in form.title.errors %}
        <p>{{ error }}</p>
        {% endfor %}
      </div>

      <div class="input-field">
        {% for error in form.location.errors %}
        <div class="row">
          <div class="col-md-offset-2 col-md-8 alert alert-danger">
            {{ error }}
          </div>
        </div>
        {% endfor %}
        {{ form.location }}
        <label for="{{ form.location.id_for_label }}">
          {{ form.location.label }}
        </label>
      </div>

      <div class="input-field">
        {% for error in form.description.errors %}
        <div class="row">
          <div class="col-md-offset-2 col-md-8 alert alert-danger">
            {{ error }}
          </div>
        </div>
        {% endfor %}
        <textarea id="{{ form.description.id_for_label }}" class="materialize-textarea" name="description"></textarea>
        <label for="{{ form.description.id_for_label }}">
          {{ form.description.label }}
        </label>
      </div>

      <div class="input-field">
        {% for error in form.dtstart.errors %}
        <div class="row">
          <div class="col-md-offset-2 col-md-8 alert alert-danger">
            {{ error }}
          </div>
        </div>
        {% endfor %}
        {{ form.dtstart }}
        <label for="{{ form.dtstart.id_for_label }}">
          {{ form.dtstart.label }}
        </label>
      </div>

      <div class="input-field">
        {% for error in form.dtend.errors %}
        <div class="row">
          <div class="col-md-offset-2 col-md-8 alert alert-danger">
            {{ error }}
          </div>
        </div>
        {% endfor %}
        {{ form.dtend }}
        <label for="{{ form.dtend.id_for_label }}">
          {{ form.dtend.label }}
        </label>
      </div>

      <div class="input-field">
        <input type="checkbox" name="{{ form.all_day.name }}" id="{{ form.all_day.id_for_label }}" />
        {{ form.all_day.label_tag }}
      </div>

      <div class="input-field">
        <input type="checkbox" name="{{ form.private.name }}" id="{{ form.private.id_for_label }}" />
        {{ form.private.label_tag }}
      </div>

      <div id="details-div" class="input-field">
        {% for error in form.details.errors %}
        <div class="row">
          <div class="col-md-offset-2 col-md-8 alert alert-danger">
            {{ error }}
          </div>
        </div>
        {% endfor %}
        <textarea id="{{ form.details.id_for_label }}" name="details"
                                                       class="materialize-textarea"></textarea>
        <label for="{{ form.details.id_for_label }}">
          {{ form.details.label }}
        </label>
      </div>

      <div id="group-div" class="input-field col s12">
        {{ form.group }}
        <label>
          {% trans 'Limit access to' %}:
        </label>
      </div>
      <p>
      {% trans 'Details are only visible to users that are logged in. You can further limit visibility to a specific group.' %}
      </p>
    </div>
    <div class="card-action">
      <input type='submit' class="btn" value="{% if edit %}{% trans 'Edit Event' %}{% else %}{% trans 'Create Event' %}{% endif %}">
    </div>
  </form>
</div>
{% endblock %}

{% block javascript %}
<script type="text/javascript">
$('select').material_select();
$(function() {
  $('#id_private').change(function() {
    change_private_view()
  });
  $('#id_all_day').change(function() {
    change_all_day_view()
  });
});
{% if form.private.value %}
$('#id_private').prop('checked', true);
{% else %}
$('#id_private').prop('checked', false);
{% endif %}
{% if form.all_day.value %}
$('#id_all_day').prop('checked', true);
{% else %}
$('#id_all_day').prop('checked', false);
{% endif %}

change_private_view();
change_all_day_view();
function change_all_day_view() {
  if ($('#id_all_day').prop('checked')) {
    $('#end-date-div').addClass('hidden');
  } else {
    $('#end-date-div').removeClass('hidden');
  }
}
function change_private_view() {
  if ($('#id_private').prop('checked')) {
    $("#details-div").addClass("hidden");
    $("#group-div").removeClass("hidden");
    $("#id_group").prop('required', true);
  } else {
    $("#details-div").removeClass("hidden");
    $("#group-div").addClass("hidden");
    $("#id_group").prop('required', false);
  }
}
</script>
{% endblock %}
