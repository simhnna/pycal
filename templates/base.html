{% load i18n %}
{% load staticfiles %}
{% load tz %}
{% load common_tags %}
{% get_current_timezone as TIME_ZONE %}
{% get_timezone as timezones %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
  <head>
    <title>Calendar</title>
    <link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}">
    <link rel="stylesheet" href="{% static "css/bootstrap-theme.min.css" %}">
    <link rel="stylesheet" href="{% static "css/own.css" %}">
    {% block css %}{% endblock %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>

  <body>
    <div class="wrapper">
      <div class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{% url 'index' %}">pyCal</a>
          </div> <!-- navbar-header -->

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li {% if home %}class="active"{% endif %}><a href="{% url 'index' %}">Home</a></li>
              <li {% if calendar %}class="active"{% endif %}><a href="{% url 'calendar' %}">{% trans 'Calendar' %}</a></li>
              {% if user.is_authenticated %}
              <li {% if create_event %}class="active"{% endif %}><a href="{% url 'events:create_event' %}">{% trans 'New Event' %}</a></li>
              {% endif %}
            </ul>
            <ul class="nav navbar-nav navbar-right">
              {% if user.is_authenticated %}
              {% if user.is_staff %}
              <li><a href="{% url 'admin:index' %}">Admin interface</a></li>
              {% endif %}
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">{% trans 'Account' %}<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="{% url 'profiles:change_password' %}">{% trans 'Change Password'%} </a></li>
                  <li><a href="{% url 'profiles:change_email' %}">{% trans 'Change Email' %}</a></li>
                  <li><a href="{% url 'profiles:edit_account' %}">{% trans 'Edit Account' %}</a></li>
                  <li class="divider"></li>
                  <li><a href="{% url 'profiles:sign_out' %}">{% trans 'Sign out' %}</a></li>
                </ul>
              </li>
              {% else %}
              <li><a href="{% url 'profiles:register' %}">{% trans 'Register' %}</a></li>
              <li><a href="{% url 'profiles:sign_in' %}">{% trans 'Sign in' %}</a></li>
              {% endif %}
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </div> <!-- navbar -->
      <div class="container">
        {% if messages %}
        {% for message in messages %}
        <div class="fade alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} alert-dismissable">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
          {{ message }}
        </div> <!-- alert -->
        {% endfor %}
        {% endif %}

        {% block content %}{% endblock %}
      </div> <!-- container -->
    </div> <!-- wrapper-->
    <div class="footer">
      <p class="muted credit">
      &copy; {% now "Y" %} Simon Hanna 
      &bull; 
      <a data-toggle="modal" data-target="#myModal" href="#">{{ request.session.django_timezone | default:"Europe/Berlin" }}</a>
      &bull;
      <a href="{% url 'feedinfo' %}">ical</a>
      </p>
    </div><!--footer -->

    <div class="modal fade" id="myModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Choose a timezone</h4>
          </div>
          <div class="modal-body">
            <form class="form-inline" action="{% url 'set_timezone' %}" method="POST">
              {% csrf_token %}
              <div class="form-group">
                <label for="timezone">Time zone:</label>
                <select class="form-control" name="timezone">
                  {% for tz in timezones %}
                  <option value="{{ tz }}"{% if tz == TIME_ZONE %} selected="selected"{% endif %}>{{ tz }}</option>
                  {% endfor %}
                </select>
                <input type="hidden" name="next" value="{{ request.path }}"/>
                <input type="submit" class="btn btn-primary" value="Set" />
              </div>
            </form>
          </div><!-- modal-body -->
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
  </body>

  <script src="{% static "js/jquery.min.js" %}"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="{% static "js/bootstrap.min.js" %}"></script>
  <script>
    setTimeout(function(){$('.alert').addClass("in")}, 500);
    setTimeout(function(){$(".alert").alert('close')}, 3000);
  </script>
  {% block javascript %} {% endblock %}
</html>
